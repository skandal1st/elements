# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Docker Hub –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è Rate Limit

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–∏ –≤—ã –º–æ–∂–µ—Ç–µ —Å—Ç–æ–ª–∫–Ω—É—Ç—å—Å—è —Å –æ—à–∏–±–∫–æ–π:

```
Error response from daemon: error from registry: 
You have reached your unauthenticated pull rate limit. 
https://www.docker.com/increase-rate-limit
```

## –ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?

Docker Hub –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ pull-–∑–∞–ø—Ä–æ—Å–æ–≤:
- **–ê–Ω–æ–Ω–∏–º–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏**: 100 pull –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤ —Å –æ–¥–Ω–æ–≥–æ IP
- **–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)**: 200 pull –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤
- **Pro –ø–æ–¥–ø–∏—Å–∫–∞**: –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ

## üöÄ –†–µ—à–µ–Ω–∏–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç
sudo ./fix-docker-rate-limit.sh

# –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç 1
# –í–≤–µ–¥–∏—Ç–µ username –∏ password –æ—Ç Docker Hub
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

#### –®–∞–≥ 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è (–µ—Å–ª–∏ –Ω–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞)

1. –û—Ç–∫—Ä–æ–π—Ç–µ https://hub.docker.com/signup
2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É:
   - Username
   - Email
   - Password (–º–∏–Ω–∏–º—É–º 9 —Å–∏–º–≤–æ–ª–æ–≤)
3. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ email

#### –®–∞–≥ 2: –í—Ö–æ–¥ –≤ Docker

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ
docker login

# –í–≤–µ–¥–∏—Ç–µ:
# Username: –≤–∞—à_username
# Password: –≤–∞—à_password
```

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞:
```
Login Succeeded
```

#### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
docker info | grep Username

# –î–æ–ª–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏ –≤–∞—à username
```

#### –®–∞–≥ 4: –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

```bash
sudo ./deploy.sh
```

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∑–µ—Ä–∫–∞–ª Docker Hub

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç
sudo ./fix-docker-rate-limit.sh

# –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç 3 (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–µ—Ä–∫–∞–ª)
```

–ò–ª–∏ –≤—Ä—É—á–Ω—É—é:

```bash
# –°–æ–∑–¥–∞–π—Ç–µ/–æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª
sudo nano /etc/docker/daemon.json

# –î–æ–±–∞–≤—å—Ç–µ:
{
  "registry-mirrors": [
    "https://mirror.gcr.io",
    "https://docker.mirrors.ustc.edu.cn"
  ]
}

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Docker
sudo systemctl restart docker

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ
docker info | grep -A 5 "Registry Mirrors"
```

### –í–∞—Ä–∏–∞–Ω—Ç 4: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö registry

–ó–∞–º–µ–Ω–∏—Ç–µ –æ–±—Ä–∞–∑—ã –≤ `docker-compose.prod.yml`:

```yaml
# –í–º–µ—Å—Ç–æ:
image: postgres:14-alpine

# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
image: docker.io/library/postgres:14-alpine
# –∏–ª–∏
image: ghcr.io/library/postgres:14-alpine  # GitHub Container Registry
```

### –í–∞—Ä–∏–∞–Ω—Ç 5: –õ–æ–∫–∞–ª—å–Ω–æ–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–∑–æ–≤

–ï—Å–ª–∏ –≤—ã —á–∞—Å—Ç–æ –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ—Ç–µ:

```bash
# –ó–∞–≥—Ä—É–∑–∏—Ç–µ –æ–±—Ä–∞–∑—ã –∑–∞—Ä–∞–Ω–µ–µ
docker pull postgres:14-alpine
docker pull redis:7-alpine
docker pull nginx:alpine

# –¢–µ–ø–µ—Ä—å –æ–Ω–∏ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º –∫–µ—à–µ
docker images

# –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–∑—ã
sudo ./deploy.sh
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –ª–∏–º–∏—Ç–∞

```bash
# –ê–Ω–æ–Ω–∏–º–Ω—ã–π –ª–∏–º–∏—Ç (–±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
TOKEN=$(curl "https://auth.docker.io/token?service=registry.docker.io&scope=repository:ratelimitpreview/test:pull" | jq -r .token)
curl --head -H "Authorization: Bearer $TOKEN" https://registry-1.docker.io/v2/ratelimitpreview/test/manifests/latest 2>&1 | grep -i ratelimit

# –í—ã–≤–æ–¥ –ø–æ–∫–∞–∂–µ—Ç:
# ratelimit-limit: 100;w=21600      (–º–∞–∫—Å–∏–º—É–º)
# ratelimit-remaining: 50;w=21600   (–æ—Å—Ç–∞–ª–æ—Å—å)
```

### –ü–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

```bash
# –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
TOKEN=$(curl --user 'username:password' "https://auth.docker.io/token?service=registry.docker.io&scope=repository:ratelimitpreview/test:pull" | jq -r .token)
curl --head -H "Authorization: Bearer $TOKEN" https://registry-1.docker.io/v2/ratelimitpreview/test/manifests/latest 2>&1 | grep -i ratelimit

# –õ–∏–º–∏—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 200
```

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è production —Å–µ—Ä–≤–µ—Ä–æ–≤

1. **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Docker Hub –∞–∫–∫–∞—É–Ω—Ç**
   ```bash
   docker login
   ```

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∑–µ—Ä–∫–∞–ª–∞ –∫–∞–∫ backup**
   ```bash
   sudo ./fix-docker-rate-limit.sh  # –≤–∞—Ä–∏–∞–Ω—Ç 3
   ```

3. **–ö–µ—à–∏—Ä—É–π—Ç–µ –æ–±—Ä–∞–∑—ã –ª–æ–∫–∞–ª—å–Ω–æ**
   ```bash
   # –ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–π —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±—Ä–∞–∑—ã –æ—Å—Ç–∞—é—Ç—Å—è –≤ –∫–µ—à–µ
   docker images
   ```

### –î–ª—è CI/CD

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Docker Hub —Ç–æ–∫–µ–Ω—ã –≤–º–µ—Å—Ç–æ –ø–∞—Ä–æ–ª—è:

1. –°–æ–∑–¥–∞–π—Ç–µ —Ç–æ–∫–µ–Ω: https://hub.docker.com/settings/security
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤ CI:
   ```bash
   echo $DOCKER_TOKEN | docker login -u $DOCKER_USERNAME --password-stdin
   ```

## –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã

**Q: –ë–µ–∑–æ–ø–∞—Å–Ω–æ –ª–∏ —Ö—Ä–∞–Ω–∏—Ç—å —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ Docker Hub –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ?**

A: Docker —Ö—Ä–∞–Ω–∏—Ç credentials –≤ `~/.docker/config.json` —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞. –î–ª—è production —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω—ã –≤–º–µ—Å—Ç–æ –ø–∞—Ä–æ–ª–µ–π.

**Q: –ù—É–∂–Ω–æ –ª–∏ –ø–ª–∞—Ç–∏—Ç—å –∑–∞ Docker Hub?**

A: –ù–µ—Ç! –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç –¥–∞–µ—Ç 200 pull –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤, —á–µ–≥–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å–ª—É—á–∞–µ–≤.

**Q: –ö–∞–∫ —á–∞—Å—Ç–æ –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å docker login?**

A: –û–¥–∏–Ω —Ä–∞–∑. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –¥–æ —è–≤–Ω–æ–≥–æ –≤—ã—Ö–æ–¥–∞ (`docker logout`).

**Q: –ß—Ç–æ –¥–µ–ª–∞—Ç—å –µ—Å–ª–∏ –∑–∞–±—ã–ª –ø–∞—Ä–æ–ª—å?**

A: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–∞ https://hub.docker.com/reset-password/

**Q: –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —á—É–∂–æ–π Docker Hub –∞–∫–∫–∞—É–Ω—Ç?**

A: –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –¥–∞, –Ω–æ –ª—É—á—à–µ —Å–æ–∑–¥–∞—Ç—å —Å–≤–æ–π. –≠—Ç–æ –±–µ—Å–ø–ª–∞—Ç–Ω–æ –∏ –∑–∞–π–º–µ—Ç 2 –º–∏–Ω—É—Ç—ã.

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- Docker Hub: https://hub.docker.com/
- Rate Limit –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://docs.docker.com/docker-hub/download-rate-limit/
- –ó–µ—Ä–∫–∞–ª–∞: https://github.com/docker/roadmap/issues/371

## –ë—ã—Å—Ç—Ä–∞—è —Å–ø—Ä–∞–≤–∫–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
docker info | grep Username

# –í—Ö–æ–¥
docker login

# –í—ã—Ö–æ–¥
docker logout

# –°–ø–∏—Å–æ–∫ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –æ–±—Ä–∞–∑–æ–≤
docker images

# –£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –æ–±—Ä–∞–∑–æ–≤ (–æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –º–µ—Å—Ç–∞)
docker image prune -a

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤
./fix-docker-rate-limit.sh
```

## –ì–æ—Ç–æ–≤–æ!

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Docker Hub –≤—ã —Å–º–æ–∂–µ—Ç–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å `docker login` **–ø–µ—Ä–µ–¥** –∑–∞–ø—É—Å–∫–æ–º `deploy.sh`.
